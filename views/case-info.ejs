<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Information - Digital Threat Assessment Management</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/onboarding.css">
    <script src="/js/onboarding.js"></script>
</head>
<body class="onboarding-body">
    <div class="onboarding-container">
        <div class="onboarding-card">
            <div class="onboarding-header">
                <h1>Digital Threat Assessment Management</h1>
            </div>
            <div class="onboarding-content">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-step completed">1</div>
                        <div class="progress-step completed">2</div>
                        <div class="progress-step active">3</div>
                        <div class="progress-step">4</div>
                    </div>
                    <div class="progress-labels">
                        <div class="progress-label completed">Terms</div>
                        <div class="progress-label completed">SOC</div>
                        <div class="progress-label active">Case</div>
                        <div class="progress-label">Summary</div>
                    </div>
                </div>
                
                <h2>Case Information</h2>
                <p>Please provide information about this case to help with organization and reporting.</p>
                
                <form action="/safety-assessment" method="POST" class="onboarding-form" id="caseInfoForm">
                    <div class="case-info-grid">
                        <div class="form-group">
                            <label for="caseId">Case/Incident ID</label>
                            <input type="text" id="caseId" name="caseId" class="form-control" placeholder="Enter case ID or reference number" required>
                        </div>
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input type="date" id="date" name="date" class="form-control" value="<%= new Date().toISOString().split('T')[0] %>" required>
                        </div>
                        <div class="form-group">
                            <label for="investigatorName">Threat Assessment Team Member</label>
                            <input type="text" id="investigatorName" name="investigatorName" class="form-control" placeholder="Enter your name" required>
                        </div>
                        <div class="form-group">
                            <label for="organization">Organization</label>
                            <input type="text" id="organization" name="organization" class="form-control" placeholder="Enter your organization">
                        </div>
                    </div>
                    
                    <div id="studentInfoSection" style="display: none;">
                        <h3>Student Information</h3>
                        <p>Please provide information about the student involved in this case.</p>
                        
                        <div class="case-info-grid">
                            <div class="form-group">
                                <label for="studentName">Student Name</label>
                                <input type="text" id="studentName" name="studentName" class="form-control" placeholder="Enter student name" required>
                            </div>
                            <div class="form-group">
                                <label for="studentId">Student ID/PEN</label>
                                <input type="text" id="studentId" name="studentId" class="form-control" placeholder="Enter student ID or PEN">
                            </div>
                            <div class="form-group">
                                <label for="grade">Grade</label>
                                <select id="grade" name="grade" class="form-control">
                                    <option value="">Select grade</option>
                                    <option value="K">Kindergarten</option>
                                    <option value="1">Grade 1</option>
                                    <option value="2">Grade 2</option>
                                    <option value="3">Grade 3</option>
                                    <option value="4">Grade 4</option>
                                    <option value="5">Grade 5</option>
                                    <option value="6">Grade 6</option>
                                    <option value="7">Grade 7</option>
                                    <option value="8">Grade 8</option>
                                    <option value="9">Grade 9</option>
                                    <option value="10">Grade 10</option>
                                    <option value="11">Grade 11</option>
                                    <option value="12">Grade 12</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="school">School</label>
                                <input type="text" id="school" name="school" class="form-control" placeholder="Enter school name">
                            </div>
                            <div class="form-group">
                                <label for="dob">Date of Birth</label>
                                <input type="date" id="dob" name="dob" class="form-control">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Support Plans (select all that apply)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="iep" name="supportPlans" value="IEP">
                                    <label for="iep">IEP (Individualized Education Plan)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="plan504" name="supportPlans" value="504">
                                    <label for="plan504">504 Plan</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="safetyPlan" name="supportPlans" value="Safety">
                                    <label for="safetyPlan">Safety Plan</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="bip" name="supportPlans" value="BIP">
                                    <label for="bip">BIP (Behavior Intervention Plan)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="otherPlan" name="supportPlans" value="Other">
                                    <label for="otherPlan">Other</label>
                                    <input type="text" id="otherPlanText" name="otherPlanText" class="form-control inline-input" placeholder="Please specify" style="display: none;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nav-buttons">
                        <a href="/soc-status" class="btn btn-secondary btn-back">Back</a>
                        <button type="submit" class="btn btn-primary">Continue</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if we're coming from the SOC status page with "known" status
            const socStatus = sessionStorage.getItem('socStatus');
            if (socStatus === 'known') {
                document.getElementById('studentInfoSection').style.display = 'block';
                
                // Make student name required only when section is visible
                document.getElementById('studentName').required = true;
            } else {
                document.getElementById('studentName').required = false;
            }
            
            // Toggle "Other" text field visibility
            const otherPlanCheckbox = document.getElementById('otherPlan');
            const otherPlanText = document.getElementById('otherPlanText');
            
            otherPlanCheckbox.addEventListener('change', function() {
                otherPlanText.style.display = this.checked ? 'inline-block' : 'none';
            });
        });
    </script>
</body>
</html>
